<?xml version="1.0" encoding="UTF-8"?>

<!-- ==== #26. mapper 기본 설정 -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- ==== #27. 루트 엘리먼트 및 네임스페이스 설정하기(이 네임스페이스의 이름은 프로젝트 전체 내에서 반드시 고유해야만 한다.) --> 
<mapper namespace="jdhresns">


<!-- 로그인 여부 알아오기 === -->
	<select id="loginEnd" parameterType="HashMap" resultType="int">
	
		   select case (select count(*)
                    from tbl_login
                    where login_id = #{id} and login_pwd = #{pwd}
                    and login_status in (1,9))
	        when 1 then 1
	        else ( case (select count(*)
	                from tbl_login
	                where login_id = #{id})
	               when 1 then 0
	               else -1
	               end
	              )
	            end as LOGINCHECK
	 	from dual
	
	</select>
	
	
	<select id="getLoginMember" parameterType="String" resultType="com.spring.jdh.model.UserVO">
	
		select fk_login_id, user_email, user_birth, user_gender, user_ing, user_ed, user_boardcnt, user_report
		from tbl_user
		where fk_login_id = #{id}
	</select>
	
	<select id="getloginSession" parameterType="String" resultType="com.spring.jdh.model.LoginVO">
	
		select login_id, login_pwd, login_name, login_status
		from tbl_login
		where login_status in (1,9)
		and login_id = #{id}
	</select>
	
	
	<!-- 아이디 찾기 -->
	<select id="getUserid" parameterType="HashMap" resultType="String">
		select m.login_id 
		from tbl_login M join tbl_user D on M.login_id = D.FK_LOGIN_ID
		where m.login_status in (1,9)
		and d.user_email = #{email}
		and m.login_name like #{nickname}
	</select>
	
	<!-- 아이디와 메일이 존재하는지 여부 -->
	<select id="getUserExists" parameterType="HashMap" resultType="int">
	
	select count(*)
	from tbl_user
	where fk_login_id = #{userid} and user_email = #{email}
		
	</select>
	
	<!-- 비밀번호 재설정 -->
	
	<update id="updatePwd" parameterType="HashMap">
		update tbl_login set login_pwd = #{pwd}
		where login_id = #{userid}
	</update> 
	
	<!-- 회원가입 인서트 -->
	<insert id="registerMember" parameterType="com.spring.jdh.model.LoginVO">
	 
	 	insert into tbl_login(login_id, login_pwd, login_name, login_status)
		values(#{login_id}, #{login_pwd}, #{login_name}, 1)
	
	</insert>
	
	<insert id="registerDetail" parameterType="com.spring.jdh.model.UserVO">
	
		insert into tbl_user(fk_login_id, user_email, user_birth, user_gender, user_ing, user_ed, user_boardcnt, user_report, user_selfi)
		values(#{fk_login_id}, #{user_email}, #{user_birth}, #{user_gender}, default, default, default, default, #{user_selfi})
		
	</insert>
	
	<!-- 이미지파일 추가 -->	
	<!-- <insert id="registerImg" parameterType="com.spring.jdh.model.MemberImageVO">
		
		insert into tbl_uimage(uimg_seq,fk_login_id, uimg_profile_filename, uimg_header_filename,uimg_profile_orgfilename, uimg_header_orgfilename, uimg_profile_filesize, uimg_header_filesize)
		values(uimg_seq.nextval, #{fk_login_id}, #{uimg_profile_filename}, #{uimg_header_filename}, #{uimg_profile_orgfilename}, #{uimg_profile_filesize}, #{uimg_profile_filesize})
		
	</insert> -->
	

</mapper>