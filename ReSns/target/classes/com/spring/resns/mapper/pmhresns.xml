<?xml version="1.0" encoding="UTF-8"?>

<!-- ==== #26. mapper 기본 설정 -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- ==== #27. 루트 엘리먼트 및 네임스페이스 설정하기(이 네임스페이스의 이름은 프로젝트 전체 내에서 반드시 고유해야만 한다.) --> 
<mapper namespace="pmhresns">

	<resultMap type="java.util.HashMap" id="getReportListMap">
		<result property="seq_tbl_report" 	column="seq_tbl_report" javaType="String" />
 		<result property="report_cate" 		column="report_cate" 	javaType="String" />
 		<result property="report_content" 	column="report_content" javaType="String" />
 		<result property="report_user" 		column="report_user" 	javaType="String" />
 		<result property="report_date1" 	column="report_date1" 	javaType="String" />
 		<result property="report_status" 	column="report_status" 	javaType="String" />
	</resultMap>
	<select id="getReport" resultMap="getReportListMap">
		select seq_tbl_report, report_cate, report_content, report_user, report_date1, report_status
		from view_report_main
	</select>
	
		<resultMap type="java.util.HashMap" id="getReportDetailMap">
		<result property="seq_tbl_report" column="seq_tbl_report" javaType="String" />	
		<result property="report_cate" column="report_cate" javaType="String" />	
		<result property="reporting_name" column="reporting_name" javaType="String" />	
		<result property="reporting_id" column="reporting_id" javaType="String" />	
		<result property="report_name" column="report_name" javaType="String" />	
		<result property="report_id" column="report_id" javaType="String" />	
		<result property="report_date1" column="report_date1" javaType="String" />	
		<result property="report_date2" column="report_date2" javaType="String" />	
		<result property="report_status" column="report_status" javaType="String" />	
		<result property="fk_seq_tbl_board" column="fk_seq_tbl_board" javaType="String" />	
		<result property="report_content" column="report_content" javaType="String" />	
	</resultMap>
	<select id="getReportDetail" parameterType="String" resultMap="getReportDetailMap">
		select seq_tbl_report, report_cate, reporting_name, reporting_id, report_name, report_id, report_date1, report_date2, report_status, fk_seq_tbl_board, report_content
		from view_report_detail
		where fk_seq_tbl_board = #{seq}
	</select>
	
	<select id="getBoardContent" parameterType="String" resultType="com.spring.pek.model.BoardVO">
		select seq_tbl_board, fk_login_id, board_content, board_status, to_char(board_time, 'yyyy-mm-dd hh24:mi:ss') as board_time, board_heart, board_recnt
		from tbl_board
		where seq_tbl_board = #{reportnum}
	</select>
	
	<select id="getReContent" parameterType="String" resultType="com.spring.pek.model.ReVO">
		select re_seq, seq_tbl_board, re_id, re_content, to_char(re_date, 'yyyy-mm-dd hh24:mi:ss') as re_date, re_status, re_fk_seq, re_groupno, re_depthno
		from tbl_re
		where seq_tbl_board = #{reportnum}
		start with re_fk_seq = 0
		connect by prior re_seq = re_fk_seq
		order siblings by re_groupno desc, re_seq asc
	</select>
	
	<select id="getBimageContent" parameterType="String" resultType="com.spring.pek.model.BimageVO">
		select bimg_seq, seq_tbl_board, bimg_filename, bimg_orgfilename, bimg_filesize
		from tbl_bimage
		where seq_tbl_board = #{reportnum}
	</select>
	
	<update id="updateBoardContentStatusDel" parameterType="String">
		update tbl_board set board_status = 2
		where seq_tbl_board = #{seq}
	</update>
	
	<update id="updateReContentStatusDel" parameterType="String">
		update tbl_re set re_status = 0
		where seq_tbl_board = #{seq}
	</update>
	
	<update id="updateReportStatusDel" parameterType="String">
		update tbl_report set report_date2 = sysdate
       			            , report_status = 0
		where fk_seq_tbl_board = #{seq}
	</update>
	
	<update id="updateBoardContentStatusAct" parameterType="String" >
		update tbl_board set board_status = 1
		where seq_tbl_board = #{seq}
	</update>
	
	<update id="updateReContentStatusAct" parameterType="String" >
		update tbl_re set re_status = 1
		where seq_tbl_board = #{seq}
	</update>
	
	<update id="updateReportStatusAct" parameterType="String" >
		update tbl_report set report_date2 = null
       			            , report_status = 2
		where fk_seq_tbl_board = #{seq}
	</update>
	
	<select id="getReportSearch" parameterType="HashMap" resultMap="getReportListMap">
		select rno, seq_tbl_report, report_cate, report_content, report_user, report_date1, report_status
		from view_report_main
		where ${searchType} like '%'||#{searchInput}||'%'
	</select>

</mapper>